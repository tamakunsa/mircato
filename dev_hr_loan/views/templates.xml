<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Breadcrumbs of Timeoff -->
    <template id="portal_my_home_menu_loan" name="Portal layout : Loans menu entry"
              inherit_id="portal.portal_breadcrumbs" priority="25">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'loans' or loans" t-attf-class="breadcrumb-item #{'active ' if not loans else ''}">
                <a t-if="leave" t-attf-href="/my/loans?{{ keep_query() }}">
                    Loans
                </a>
                <t t-else="">
                    Loans
                </t>
            </li>
            <li t-if="loans" class="breadcrumb-item active">
                <span t-field="loans.name"/>
            </li>
        </xpath>
    </template>

    <!-- My Leaves menu in Main portal document page -->
    <template id="portal_my_loans" name="Portal My Loans : Loans entries"
              inherit_id="portal.portal_my_home" priority="20">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="title">My Loans</t>
                <t t-set="url" t-value="'/my/loans'"/>
                <t t-set="text">Display your Loans</t>
                <t t-set="config_card" t-value="True"/>
            </t>
        </xpath>
    </template>

    <!-- Timeoff template -->
    <template id="portal_my_loans_details" name="My Leaves">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Loans</t>
                <!--                <div class="form-inline ml-lg-4" t-if="request.env.user.employee_id">-->
                <!--                    <button class="btn btn-success btn-sm" name='new_loans' data-toggle="modal"-->
                <!--                            data-target=".modal_new_loan" title="Add New Loan" aria-label="Add New Loan">-->
                <!--                        <i class="fa fa-plus"/>-->
                <!--                        Create New-->
                <!--                    </button>-->
                <!--                </div>-->
            </t>
            <div class="modal fade modal_new_loan" role="form">
                <div class="modal-dialog">
                    <form method="POST" class="modal-content js_website_submit_form new_loans_form">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <header class="modal-header">
                            <h4 class="modal-title">New Loan Request</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;
                            </button>
                        </header>
                        <main class="modal-body" id="new-opp-dialog">
                            <div class="form-group">
                                <label for="description">Description</label>
                                <input type="text" class="form-control name" name="name" id="" placeholder=""/>
                            </div>
                            <div class="form-group">
                                <label for="loan_type">Loan Type</label>
                                <select name="loan_type_id" class="form-control loan_type_select loan_type_id"
                                        required="True">
                                    <t t-foreach="loan_types or []" t-as="htype">
                                        <option t-att-value="htype[0]">
                                            <t t-esc="htype[1]"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="date">Date</label>
                                    <div class="input-group date">
                                        <input type="date" name="request_date"
                                               class="form-control date_from request_date" data-date-format="YYYY-MM-DD"
                                               placeholder="YYYY-MM-DD"/>
                                        <div class="input-group-append">
                                            <span class="input-group-text">
                                                <span class="fa fa-calendar" role="img" aria-label="Calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="request_loan_amount">Loan Amount</label>
                                    <input type="text" class="form-control request_loan_amount"
                                           name="request_loan_amount" id="" placeholder=""/>

                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label class="control-label" for="request_term">Loan Term</label>
                                    <input type="text" class="form-control request_term" name="request_term" id=""
                                           placeholder=""/>

                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-8">
                                    <label class="control-label" for="request_notes">Loan Request Reason</label>
                                    <input type="text" class="form-control request_notes" name="request_notes" id=""
                                           placeholder=""/>

                                </div>
                            </div>
                        </main>
                        <footer class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button t-attf-class="btn btn-primary new_loan_confirm">Confirm</button>
                        </footer>
                    </form>
                </div>
            </div>

            <t t-if="not grouped_loans">
                <div class="alert alert-warning mt8" role="alert">
                    There are no Loans
                </div>
            </t>
            <t t-if="grouped_loans">
                <t t-call="portal.portal_table">
                    <t t-foreach="grouped_loans" t-as="leave">
                        <thead>
                            <tr t-attf-class="{{'thead-light' if not groupby == 'none' else ''}}">
                                <th t-if="groupby == 'none'">Loans type</th>
                                <th t-else="">
                                    <em class="font-weight-normal text-muted">Loans Type:</em>
                                    <span t-field="loans[0].loan_type_id.name"/>
                                </th>
                                <th>Description</th>
                                <th>Loan date</th>
                                <th>Loan Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="loans" t-as="loan">
                                <tr>
                                    <td>
                                        <span t-field="loan.loan_type_id.name"/>
                                    </td>
                                    <td>
                                        <a t-if="leave.name" t-attf-href="/my/loans/#{loan.id}">
                                            <span t-field="loan.name"/>
                                        </a>
                                        <a t-else="" class="btn btn-primary btn-sm" t-attf-href="/my/loans/#{loan.id}">
                                            <span>Add Description</span>
                                        </a>
                                    </td>
                                    <td>
                                        <span t-field="loan.date"/>
                                    </td>
                                    <td>
                                        <span t-field="loan.loan_amount"/>
                                    </td>
                                    <td>
                                        <span t-field="loan.state"/>
                                    </td>
                                    <td>
                                        <span t-att-class="'badge badge-success' if loan.state=='draft' else ''
                                                           'badge badge-primary' if loan.state=='request' else ''
                                                           'badge badge-danger' if loan.state=='dep_approval' else ''
                                                           'badge badge-warning' if loan.state=='hr_approval' else ''
                                                           'badge badge-light' if loan.state=='done' else ''
                                                           'badge badge-info' if loan.state=='paid' else ''
                                                           " t-field="loan.state"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </t>
                </t>
            </t>
        </t>
    </template>

    <!-- Edit Timeoff template -->
    <template id="portal_my_loans_types" name="My Loan Request">
        <t t-call="portal.portal_layout">
            <t t-call="portal.portal_record_layout">
                <t t-set="card_header">
                    <div class="row no-gutters">
                        <div class="col-md">
                            <h5 class="mb-2 mb-md-0">
                                <small class="text-muted">Loan Request -</small>
                                <span t-field="loans.display_name"/>
                            </h5>
                        </div>
                        <div class="col-md text-md-right">
                            <div class="d-inline-block">
                                <small class="mr-2 mt-1 float-left">
                                    <b>State:</b>
                                </small>
                                <div t-foreach="loans" t-as="loan" class="float-left">
                                    <span t-att-class="'badge badge-success' if loan.state=='draft' else ''
                                                           'badge badge-primary' if loan.state=='request' else ''
                                                           'badge badge-danger' if loan.state=='dep_approval' else ''
                                                           'badge badge-warning' if loan.state=='hr_approval' else ''
                                                           'badge badge-light' if loan.state=='done' else ''
                                                           'badge badge-info' if loan.state=='paid' else ''
                                                           " t-field="loan.state"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
                <!---->
                <t t-set="card_body">
                    <div class="row">
                        <div class="col-lg-5 mb-4 mb-lg-0">
                            <div class="border-bottom d-flex justify-content-between py-2 mb-3 align-items-center">
                                <h5 class="mb-0">
                                    <span class="text-nowrap" t-esc="loans.name"/>
                                </h5>
                                <!--                                <button t-if="timeoff.state == 'confirm'" type="button" data-toggle="modal" data-target=".modal_edit_timeoff" class="btn btn-link btn-sm"><i class="fa fa-pencil mr-1"/>Edit</button>-->
                            </div>
                            <div class="row mb-2">
                                <strong class="col-12 col-sm-4">Loan Type</strong>
                                <div class="col">
                                    <span t-if="loans.loan_type_id" t-field="loans.loan_type_id"/>
                                    <span t-else="" class="text-muted">-</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <strong class="col-12 col-sm-4">Date</strong>
                                <div class="col">
                                    <span t-if="loans.date" t-field="loans.date"/>
                                    <span t-else="" class="text-muted">-</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <strong class="col-12 col-sm-4">Loan Amount</strong>
                                <div class="col">
                                    <span t-if="loans.loan_amount" t-field="loans.loan_amount"/>
                                    <span t-else="" class="text-muted">-</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <strong class="col-12 col-sm-4">Loan Term</strong>
                                <div class="col">
                                    <span t-if="loans.term" t-field="loans.term"/>
                                    <span t-else="" class="text-muted">-</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <strong class="col-12 col-sm-4">Loan Note Reason</strong>
                                <div class="col">
                                    <span t-if="loans.notes" t-field="loans.notes"/>
                                    <span t-else="" class="text-muted">-</span>
                                </div>
                            </div>
                        </div>
                        <div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Summary Template -->
    <template id="my_leaves_summary" name="My Leaves Summary">
        <t t-call="portal.portal_layout">
            <t t-call="portal.portal_record_layout">
                <t t-set="card_header">
                    <div class="row no-gutters">
                        <div class="col-md">
                            <h5 class="mb-2 mb-md-0">
                                <small class="text-muted">Leaves Summary</small>
                            </h5>
                        </div>
                    </div>
                </t>
                <t t-set="card_body">
                    <div class="o_summary">
                        <div class="o_timeoff_container d-flex">
                            <div t-foreach="timeoffs" t-as="timeoff"
                                 class="o_timeoff_card flex-grow-1 d-flex flex-column">
                                <t t-set="need_allocation" t-value="timeoff[2] != 'no'"/>
                                <t t-set="cl" t-value="'text-muted'"/>
                                <div class="mt-2">
                                    <t t-if="need_allocation">
                                        <span t-esc="timeoff[1]['virtual_remaining_leaves']"
                                              class="o_timeoff_big o_timeoff_purple"/>
                                        /
                                        <span t-esc="timeoff[1]['max_leaves']"/>
                                        <t t-if="timeoff[1]['request_unit'] == 'hour'">Hours</t>
                                        <t t-else="">Days</t>
                                    </t>
                                    <t t-else="">
                                        <span t-esc="timeoff[1]['virtual_leaves_taken']"
                                              class="o_timeoff_big o_timeoff_purple"/>
                                        <t t-if="timeoff[1]['request_unit'] == 'hour'">Hours</t>
                                        <t t-else="">Days</t>
                                    </t>
                                </div>
                                <b>
                                    <span t-esc="timeoff[0]" class="o_timeoff_name"/>
                                </b>
                                <span class="mb-4" t-if="need_allocation">
                                    <span t-attf-class="mr-1 font-weight-bold {{ cl }}"
                                          t-esc="timeoff[1]['virtual_remaining_leaves']"/>
                                    <span>remaining</span>
                                    -
                                    <span t-attf-class="mr-1 font-weight-bold {{ cl }}"
                                          t-esc="timeoff[1]['virtual_leaves_taken']"/>
                                    <span>taken</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="portal_my_home_loans" name="My Loans" inherit_id="portal.portal_my_details">
        <xpath expr="//button[@id='loans_button']" position="replace">
            <button type="button" data-dismiss="modal" style="width: 105px !important;border:none;"
                    class="btn btn-primary">
                <t t-call="portal.portal_docs_entry" style="width:100%;">
                    <t t-set="title">Loans</t>
                    <t t-set="url" t-value="'/my/loans'"/>
                </t>
            </button>
        </xpath>
    </template>

</odoo>
